<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const speedText = document.getElementById("speed");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const carImg = new Image();
carImg.src = "car.png";

let car = {
 x:0,
 y:0,
 angle:0,
 speed:0,
 accel:0.2,
 maxSpeed:7,
 friction:0.05,
 turn:0.04
};

const keys={};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

function update(){
 if(keys["ArrowUp"]) car.speed+=car.accel;
 if(keys["ArrowDown"]) car.speed-=car.accel;

 if(car.speed>car.maxSpeed) car.speed=car.maxSpeed;
 if(car.speed<-car.maxSpeed/2) car.speed=-car.maxSpeed/2;

 if(car.speed>0) car.speed-=car.friction;
 if(car.speed<0) car.speed+=car.friction;
 if(Math.abs(car.speed)<car.friction) car.speed=0;

 if(car.speed!==0){
  let dir=car.speed>0?1:-1;
  if(keys["ArrowLeft"]) car.angle-=car.turn*dir;
  if(keys["ArrowRight"]) car.angle+=car.turn*dir;
 }

 car.x+=Math.cos(car.angle)*car.speed;
 car.y+=Math.sin(car.angle)*car.speed;

 speedText.textContent=Math.abs(Math.round(car.speed*40));
}

function drawRoad(){
 ctx.fillStyle="#2b2b2b";
 ctx.fillRect(0,0,canvas.width,canvas.height);

 ctx.strokeStyle="#fff";
 ctx.setLineDash([25,25]);
 ctx.lineWidth=2;

 for(let i=-2000;i<2000;i+=60){
  ctx.beginPath();
  ctx.moveTo(canvas.width/2+i-car.x,0);
  ctx.lineTo(canvas.width/2+i-car.x,canvas.height);
  ctx.stroke();
 }
}

function drawCar(){
 ctx.save();
 ctx.translate(canvas.width/2,canvas.height/2);
 ctx.rotate(car.angle);

 ctx.drawImage(carImg,-30,-60,60,120);

 ctx.restore();
}

function loop(){
 update();
 drawRoad();
 drawCar();
 requestAnimationFrame(loop);
}
loop();
</script>
